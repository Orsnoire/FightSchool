Combat telemetry and toast consolidation:
Refactor all of the phases everywhere in the code base so that it follows this vision:
Waiting Phase:
Teacher/host waits for players to join. Toast window shows the join code. On the teacher panel, an always-up toast window (centered on the screen) keeps the join code up, and the combat area on the host screen behind the toast window shows players populating in a grid (as the behavior works now).
End of phase: when the teacher presses the “Start” button (renamed from “Start Fight”)
Question Phase:
Starts when: the “Start” button is pressed (only happens once per session), or the teacher presses the “Force Round Restart” button (teacher doesn’t need to see the phase name).
Behavior:
1.	Modal window animates open in the center of the screen saying “Question” (for the first question “Next Question” (for any question after the first time the question phase starts in any given session – the “Force Round Restart” button should also call the “Next Question” modal window). This window stays open for 3 seconds, and animates closed.
2.	Question Modal window animates open, presents the question (using current logic). This modal window closes after a student presses submit, replaced by a modal window centered with the remaining timer.
3.	Any “Question Phase” abilities now open modal windows to select targets as needed. This only happens AFTER the question modal window closes, and BEFORE the end of phase.
4.	Decide on this round’s Threat leader. Assign the crown icon to that student in both the host pane and the student ui mini-avatars.
Ends when: a) the timer runs out (all behavior is interrupted and forced into the next phase) b) all students have answered and selected their ability choices for Question Phase abilities c) more than 10 seconds of no activity.
Block and Healing Phase:
Behavior:
1.	Any player with a block choice selects their target. A modal window appears for block selection. Player Avatars are organized according to first Agro and second HP. The order of this modal is first (for those with multiple modals). Only include player avatars that meet EITHER criteria: a) current threat leader or b) missing HP.
2.	Any player with a healing choice selects their target. A modal appears for healing selection. Player avatars are organized according to most missing HP to least. The order of this modal is second. Only include player avatars that meet the criteria of missing HP.
3.	All ability selections for this phase appear in the following order (starting from the 3rd in appearance order): Warrior, Wizard, Scout, Herbalist, Warlock, Priest, Paladin, Dark Knight, Blood Knight (and new classes are added on in the order when they are added to the database).
Ends when: a) A timer of 10 seconds (up from 5) ends - all modals should display the timer, or b) all students have completed their modal selections and no modals are up on any student screen or c) more than 5 seconds of no activity.
Question Resolution Phase:
Behavior:
1.	Calculate all damage, healing and blocking resolutions from the Question and Block and Healing phases.
2.	Students who answered correctly have a modal appear in the middle of the screen with the following text “Correct! Your question dealt DMG damage to ENEMY!” (where DMG is the current damage calculation for that player’s base damage) and ENEMY is the enemy name. ONLY SHOW THIS MODAL FOR PLAYERS WHO DEALT BASE DAMGE. Keep this modal up for 2 seconds.
3.	Students who answered incorrectly have a modal appear in the middle of the screen with the following text “Incorrect. ENEMY deals FIGHTDAMAGE damage to you!” and make the screen shake. Keep this modal up for 2 seconds.
4.	Students who answered correctly and used an ability this turn, have a modal appear in the middle of the screen with the following text “Correct! ABILITY dealt DMG damage to ENEMY!” where ABILITY is the ability button they pressed to deal damage this round. Keep this modal up for 2 seconds.
5.	Students who successfully blocked question damage get a modal pop up in the middle of their screen with the following text “You blocked BLOCKEDPLAYER’s BLOCKED damage!” where BLOCKEDPLAYER is the player they blocked and BLOCKED is the damage amount that was blocked. Keep this modal up for 2 seconds.
6.	Students who were selected to be blocked for AND got their question wrong AND had HP damage loss calculated for this phase have a modal that appears in the middle of their screen with the following text “BLOCKINGPLAYER blocked HPDAMAGE damage for you!” where BLOCKINGPLAYER is the player who chose this player to block and HPDAMAGE is the amount of damage that would have caused HP subtraction absent the block. Keep this modal up for 2 seconds.
7.	Students who successfully healed get a modal pop up in the middle of their screen with the following text “You healed HEALEDPLAYER for HEALEDHP HP!” where HEALEDPLAYER is the name of the player they healed and HEALEDHP is the calculated HP that was healed. Keep this modal up for 2 seconds.
8.	Students who used a Block and Healing phase ability other than blocking or healing have a modal appear in the middle of the screen with the following text “ABILITY dealt DMG damage to ENEMY!” Keep this modal up for 2 seconds
9.	Have a modal appear after any player no longer has a modal up from scripts 2-8, animate the boss image to fill the middle of the screen, with the text over the top that reads “Your party dealt TOTALDAMAGE damage to ENEMY!” where TOTALDAMAGE is the sum of all damage dealt this round. Have the enemy image shake red for 2 seconds (or modal closes, whichever comes first). For simultaneous fights, show all current enemy images, and have each enemy damaged shake red in sequence, starting 0.1 seconds after each other. Select the sequence according to the order designated by the teacher. This/these image(s) and text remain visible until all other modals have closed for players who still have them.
Ends when: The timers for modals called by scripts 1-8 complete, or there is no modal called within 4 seconds.
Enemy AI phase:
Behavior:
1.	Phase starts with the enemy image animating into a modal that fills the center of the screen. For simultaneous fights, divide the center so all current enemies are displayed, and all current enemy images animate to fill the center-screen modal (they should all occupy the same real estate that the single enemy would have occupied).
2.	A modal appears for all students at ¼ of the size of the attacker’s image, centered on the attacker, that has the following text “ENEMY counterattacks PLAYER for DAMAGE damage!” where PLAYER is the threat leader and DAMAGE is the calculated damage.
3.	Leave this phase open for future additions to AI scripting.
Ends when: All current enemy AI scripts have run, or 3 seconds after the last damage modal is displayed, whichever comes last.
State Check Phase:
Behavior:
1.	Check enemy HP. If all enemies assigned to this session are at most 0 HP, then call the Victory script.
2.	Check player HP. If all players have at most 0 HP, then call the Defeat script.
3.	If 1 and 2 do not call scripts, then call the “Next Question” modal window and restart Question Phase.
